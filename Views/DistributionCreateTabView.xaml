<UserControl x:Class="Boutique.Views.DistributionCreateTabView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:Boutique.ViewModels"
             mc:Ignorable="d"
             d:DataContext="{d:DesignInstance vm:DistributionEditTabViewModel, IsDesignTimeCreatable=False}"
             x:Name="Root"
             d:DesignHeight="600"
             d:DesignWidth="1100">
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*" />
            <ColumnDefinition Width="10" />
            <ColumnDefinition Width="3*" />
        </Grid.ColumnDefinitions>

        <!-- Distribution Entries Editor -->
        <GroupBox Grid.Column="0" Header="Distribution Entries" Padding="6">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!-- File Selector -->
                <StackPanel Grid.Row="0" Margin="0,0,0,6">
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                        <TextBlock Text="File:" VerticalAlignment="Center" Margin="0,0,6,0" />
                        <ComboBox ItemsSource="{Binding AvailableDistributionFiles}"
                                  SelectedItem="{Binding SelectedDistributionFile, Mode=TwoWay}"
                                  DisplayMemberPath="DisplayName"
                                  MinWidth="250" Margin="0,0,6,0" />
                        <TextBlock Text="Format:" VerticalAlignment="Center" Margin="12,0,6,0" />
                        <ComboBox ItemsSource="{Binding AvailableFormats}"
                                  SelectedItem="{Binding DistributionFormat, Mode=TwoWay}"
                                  MinWidth="120" Margin="0,0,6,0">
                            <ComboBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding Converter={StaticResource DistributionFileTypeConverter}}" />
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                        </ComboBox>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Visibility="{Binding ShowNewFileNameInput, Converter={StaticResource BoolToVisConverter}}">
                        <TextBlock Text="Filename:" VerticalAlignment="Center" Margin="0,0,6,0" />
                        <TextBox Text="{Binding NewFileName, UpdateSourceTrigger=PropertyChanged}" VerticalAlignment="Center" MinWidth="200" Margin="0,0,6,0" />
                        <Button Content="Browse..." Command="{Binding SelectDistributionFilePathCommand}" Padding="8,2" />
                    </StackPanel>
                    <!-- Conflict Warning -->
                    <Border Margin="0,6,0,0" Padding="8" CornerRadius="4" Visibility="{Binding HasConflicts, Converter={StaticResource BoolToVisConverter}}">
                        <Border.Background><SolidColorBrush Color="#FF8C00" Opacity="0.15" /></Border.Background>
                        <Border.BorderBrush><SolidColorBrush Color="#FF8C00" /></Border.BorderBrush>
                        <Border.BorderThickness><Thickness>1</Thickness></Border.BorderThickness>
                        <StackPanel>
                            <TextBlock Text="{Binding ConflictSummary}" TextWrapping="Wrap" Foreground="#CC6600" FontSize="11" />
                            <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                <TextBlock Text="Suggested: " Foreground="#CC6600" FontWeight="Bold" FontSize="11" />
                                <TextBlock Text="{Binding SuggestedFileName}" Foreground="#CC6600" FontFamily="Consolas" FontWeight="Bold" FontSize="11" />
                            </StackPanel>
                        </StackPanel>
                    </Border>
                </StackPanel>

                <!-- Action Buttons -->
                <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,6">
                    <Button Content="Add Entry" Command="{Binding AddDistributionEntryCommand}" Margin="0,0,6,0" Padding="8,2" />
                    <Button Content="Load File" Command="{Binding LoadDistributionFileCommand}" Margin="0,0,6,0" Padding="8,2" />
                    <Button Content="Save File" Command="{Binding SaveDistributionFileCommand}" Margin="0,0,6,0" Padding="8,2" />
                    <Button Content="ðŸ“‹ Paste Filter" Command="{Binding PasteFilterToEntryCommand}" Padding="8,2"
                            ToolTip="{Binding CopiedFilter.Description, StringFormat='Paste filter: {0}', FallbackValue='Paste copied filter from NPCs tab'}" />
                </StackPanel>

                <!-- Distribution Entries List -->
                <ListBox Grid.Row="2" ItemsSource="{Binding DistributionEntries}"
                         VirtualizingPanel.IsVirtualizing="True"
                         VirtualizingPanel.VirtualizationMode="Recycling"
                         VirtualizingPanel.ScrollUnit="Pixel"
                         ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                         ScrollViewer.VerticalScrollBarVisibility="Auto"
                         Background="Transparent" BorderThickness="0"
                         HorizontalContentAlignment="Stretch">
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem">
                            <Setter Property="Padding" Value="0" />
                            <Setter Property="Margin" Value="0" />
                            <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                            <Setter Property="Background" Value="Transparent" />
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="ListBoxItem">
                                        <ContentPresenter />
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </ListBox.ItemContainerStyle>
                    <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Border BorderThickness="1" Margin="0,0,0,6" Padding="6" Cursor="Hand" Background="{StaticResource Brush.PanelBackground}">
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Setter Property="BorderBrush" Value="{StaticResource Brush.BorderLight}" />
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                                    <Setter Property="Background" Value="{StaticResource Brush.CardBackground}" />
                                                    <Setter Property="BorderBrush" Value="{StaticResource Brush.Accent}" />
                                                    <Setter Property="BorderThickness" Value="2" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                    <StackPanel>
                                        <!-- Header: Assign + Outfit + Chance + Preview + Remove -->
                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,2">
                                            <RadioButton Content="Assign" IsChecked="{Binding IsSelected}"
                                                         Command="{Binding DataContext.SelectEntryCommand, ElementName=Root}"
                                                         CommandParameter="{Binding}" Margin="0,0,8,0" FontWeight="Bold" VerticalAlignment="Center" />
                                            <TextBlock Text="Outfit:" VerticalAlignment="Center" Margin="0,0,4,0" />
                                            <ComboBox ItemsSource="{Binding DataContext.AvailableOutfits, ElementName=Root}"
                                                      SelectedItem="{Binding SelectedOutfit, Mode=TwoWay}"
                                                      DisplayMemberPath="EditorID" MinWidth="140" Margin="0,0,4,0" Height="22"
                                                      MaxDropDownHeight="300" IsEditable="True" IsTextSearchEnabled="True"
                                                      TextSearch.TextPath="EditorID" DropDownOpened="ComboBox_DropDownOpened"
                                                      VerticalContentAlignment="Center" />
                                            <CheckBox Content="%" IsChecked="{Binding UseChance, Mode=TwoWay}" VerticalAlignment="Center" Margin="0,0,2,0" ToolTip="Use Chance" />
                                            <TextBox Text="{Binding Chance, UpdateSourceTrigger=PropertyChanged}" Width="32" Height="22"
                                                     IsEnabled="{Binding UseChance}" Margin="0,0,4,0" ToolTip="Chance (0-100)"
                                                     VerticalAlignment="Center" VerticalContentAlignment="Center" Padding="2,0" />
                                            <Button ToolTip="Preview Outfit" VerticalAlignment="Center" Height="22" Width="22" MinWidth="0" Padding="0" Margin="0"
                                                    Command="{Binding DataContext.PreviewEntryCommand, ElementName=Root}" CommandParameter="{Binding}">
                                                <Image Source="pack://application:,,,/Assets/eye.png" Width="12" Height="12" />
                                            </Button>
                                            <Button Content="Ã—" Command="{Binding RemoveCommand}" ToolTip="Remove Entry"
                                                    VerticalAlignment="Center" Height="22" Width="22" MinWidth="0" Padding="0" Margin="2,0,0,0" />
                                        </StackPanel>

                                        <!-- NPCs (hidden when empty) -->
                                        <StackPanel Orientation="Horizontal" Margin="0,2,0,0">
                                            <StackPanel.Style>
                                                <Style TargetType="StackPanel">
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding SelectedNpcs.Count}" Value="0">
                                                            <Setter Property="Visibility" Value="Collapsed" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </StackPanel.Style>
                                            <TextBlock Text="NPCs:" VerticalAlignment="Center" Margin="0,0,4,0" FontSize="11" Foreground="Gray" />
                                            <ItemsControl ItemsSource="{Binding SelectedNpcs}" VerticalAlignment="Center">
                                                <ItemsControl.ItemsPanel>
                                                    <ItemsPanelTemplate><StackPanel /></ItemsPanelTemplate>
                                                </ItemsControl.ItemsPanel>
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Border Margin="0,0,0,2" Padding="4,1" BorderBrush="{StaticResource Brush.Border}" BorderThickness="1" CornerRadius="2" Background="{StaticResource Brush.CardBackground}">
                                                            <StackPanel Orientation="Horizontal">
                                                                <TextBlock Text="{Binding DisplayName}" FontSize="11" VerticalAlignment="Center" />
                                                                <TextBlock Text="{Binding FormKeyString}" FontFamily="Consolas" FontSize="9" Foreground="{StaticResource Brush.TextDisabled}" Margin="4,0,0,0" VerticalAlignment="Center" />
                                                                <Button Content="Ã—" Click="RemoveNpc_Click" Tag="{Binding}" Padding="0" Margin="3,0,0,0" MinWidth="0" Width="16"
                                                                        Background="Transparent" BorderThickness="0" FontSize="10" VerticalAlignment="Center" />
                                                            </StackPanel>
                                                        </Border>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </StackPanel>

                                        <!-- Factions (hidden when empty) -->
                                        <StackPanel Orientation="Horizontal" Margin="0,2,0,0">
                                            <StackPanel.Style>
                                                <Style TargetType="StackPanel">
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding SelectedFactions.Count}" Value="0">
                                                            <Setter Property="Visibility" Value="Collapsed" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </StackPanel.Style>
                                            <TextBlock Text="Factions:" VerticalAlignment="Center" Margin="0,0,4,0" FontSize="11" Foreground="Gray" />
                                            <ItemsControl ItemsSource="{Binding SelectedFactions}" VerticalAlignment="Center">
                                                <ItemsControl.ItemsPanel>
                                                    <ItemsPanelTemplate><StackPanel /></ItemsPanelTemplate>
                                                </ItemsControl.ItemsPanel>
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Border Margin="0,0,0,2" Padding="4,1" BorderBrush="{StaticResource Brush.Border}" BorderThickness="1" CornerRadius="2" Background="{StaticResource Brush.CardBackground}">
                                                            <StackPanel Orientation="Horizontal">
                                                                <TextBlock Text="{Binding DisplayName}" FontSize="11" VerticalAlignment="Center" />
                                                                <TextBlock Text="{Binding FormKeyString}" FontFamily="Consolas" FontSize="9" Foreground="{StaticResource Brush.TextDisabled}" Margin="4,0,0,0" VerticalAlignment="Center" />
                                                                <Button Content="Ã—" Click="RemoveFaction_Click" Tag="{Binding}" Padding="0" Margin="3,0,0,0" MinWidth="0" Width="16"
                                                                        Background="Transparent" BorderThickness="0" FontSize="10" VerticalAlignment="Center" />
                                                            </StackPanel>
                                                        </Border>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </StackPanel>

                                        <!-- Keywords (hidden when empty) -->
                                        <StackPanel Orientation="Horizontal" Margin="0,2,0,0">
                                            <StackPanel.Style>
                                                <Style TargetType="StackPanel">
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding SelectedKeywords.Count}" Value="0">
                                                            <Setter Property="Visibility" Value="Collapsed" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </StackPanel.Style>
                                            <TextBlock Text="Keywords:" VerticalAlignment="Center" Margin="0,0,4,0" FontSize="11" Foreground="Gray" />
                                            <ItemsControl ItemsSource="{Binding SelectedKeywords}" VerticalAlignment="Center">
                                                <ItemsControl.ItemsPanel>
                                                    <ItemsPanelTemplate><StackPanel /></ItemsPanelTemplate>
                                                </ItemsControl.ItemsPanel>
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Border Margin="0,0,0,2" Padding="4,1" BorderBrush="{StaticResource Brush.Border}" BorderThickness="1" CornerRadius="2" Background="{StaticResource Brush.CardBackground}">
                                                            <StackPanel Orientation="Horizontal">
                                                                <TextBlock Text="{Binding DisplayName}" FontSize="11" VerticalAlignment="Center" />
                                                                <TextBlock Text="{Binding FormKeyString}" FontFamily="Consolas" FontSize="9" Foreground="{StaticResource Brush.TextDisabled}" Margin="4,0,0,0" VerticalAlignment="Center" />
                                                                <Button Content="Ã—" Click="RemoveKeyword_Click" Tag="{Binding}" Padding="0" Margin="3,0,0,0" MinWidth="0" Width="16"
                                                                        Background="Transparent" BorderThickness="0" FontSize="10" VerticalAlignment="Center" />
                                                            </StackPanel>
                                                        </Border>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </StackPanel>

                                        <!-- Races (hidden when empty) -->
                                        <StackPanel Orientation="Horizontal" Margin="0,2,0,0">
                                            <StackPanel.Style>
                                                <Style TargetType="StackPanel">
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding SelectedRaces.Count}" Value="0">
                                                            <Setter Property="Visibility" Value="Collapsed" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </StackPanel.Style>
                                            <TextBlock Text="Races:" VerticalAlignment="Center" Margin="0,0,4,0" FontSize="11" Foreground="Gray" />
                                            <ItemsControl ItemsSource="{Binding SelectedRaces}" VerticalAlignment="Center">
                                                <ItemsControl.ItemsPanel>
                                                    <ItemsPanelTemplate><StackPanel /></ItemsPanelTemplate>
                                                </ItemsControl.ItemsPanel>
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Border Margin="0,0,0,2" Padding="4,1" BorderBrush="{StaticResource Brush.Border}" BorderThickness="1" CornerRadius="2" Background="{StaticResource Brush.CardBackground}">
                                                            <StackPanel Orientation="Horizontal">
                                                                <TextBlock Text="{Binding DisplayName}" FontSize="11" VerticalAlignment="Center" />
                                                                <TextBlock Text="{Binding FormKeyString}" FontFamily="Consolas" FontSize="9" Foreground="{StaticResource Brush.TextDisabled}" Margin="4,0,0,0" VerticalAlignment="Center" />
                                                                <Button Content="Ã—" Click="RemoveRace_Click" Tag="{Binding}" Padding="0" Margin="3,0,0,0" MinWidth="0" Width="16"
                                                                        Background="Transparent" BorderThickness="0" FontSize="10" VerticalAlignment="Center" />
                                                            </StackPanel>
                                                        </Border>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </StackPanel>
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>

                <!-- Preview -->
                <GroupBox Grid.Row="3" Header="File Preview" Margin="0,6,0,0" Padding="6">
                    <TextBox Text="{Binding DistributionPreviewText, Mode=OneWay}" IsReadOnly="True" TextWrapping="Wrap" AcceptsReturn="True"
                             VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto" FontFamily="Consolas" FontSize="11" MinHeight="120" MaxHeight="200" />
                </GroupBox>
            </Grid>
        </GroupBox>

        <!-- Filter Selection -->
        <GroupBox Grid.Column="2" Header="Distribution Filters" Padding="6">
            <TabControl>
                <!-- NPCs Tab -->
                <TabItem Header="NPCs">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>
                        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,6">
                            <TextBlock Text="Search:" VerticalAlignment="Center" Margin="0,0,6,0" />
                            <TextBox Text="{Binding NpcSearchText, UpdateSourceTrigger=PropertyChanged}" MinWidth="200" />
                        </StackPanel>
                        <DataGrid Grid.Row="1" ItemsSource="{Binding FilteredNpcs}" AutoGenerateColumns="False" CanUserAddRows="False" CanUserDeleteRows="False"
                                  CanUserSortColumns="True" SelectionMode="Single" EnableRowVirtualization="True" EnableColumnVirtualization="True">
                            <DataGrid.Columns>
                                <DataGridCheckBoxColumn Header="" Binding="{Binding IsSelected, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="Auto" />
                                <DataGridTextColumn Header="Name" Binding="{Binding DisplayName}" Width="*" IsReadOnly="True" />
                                <DataGridTextColumn Header="EditorID" Binding="{Binding EditorID}" Width="200" IsReadOnly="True" />
                                <DataGridTextColumn Header="FormKey" Binding="{Binding FormKeyString}" Width="150" IsReadOnly="True">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock"><Setter Property="FontFamily" Value="Consolas" /><Setter Property="FontSize" Value="10" /></Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                                <DataGridTextColumn Header="Mod" Binding="{Binding ModDisplayName}" Width="150" IsReadOnly="True">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock"><Setter Property="Foreground" Value="Gray" /></Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                            </DataGrid.Columns>
                        </DataGrid>
                        <StackPanel Grid.Row="2" Margin="0,6,0,0">
                            <TextBlock Text="{Binding SelectedEntry.SelectedOutfit.EditorID, StringFormat='Target Entry: {0}', FallbackValue='Target Entry: (None selected)'}"
                                       FontStyle="Italic" Foreground="Gray" Margin="0,0,0,4" />
                            <Button Content="Add Selected NPCs to Entry" Command="{Binding AddSelectedNpcsToEntryCommand}" Padding="8,2" />
                        </StackPanel>
                    </Grid>
                </TabItem>

                <!-- Factions Tab -->
                <TabItem Header="Factions">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>
                        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,6">
                            <TextBlock Text="Search:" VerticalAlignment="Center" Margin="0,0,6,0" />
                            <TextBox Text="{Binding FactionSearchText, UpdateSourceTrigger=PropertyChanged}" MinWidth="200" />
                        </StackPanel>
                        <DataGrid Grid.Row="1" ItemsSource="{Binding FilteredFactions}" AutoGenerateColumns="False" CanUserAddRows="False" CanUserDeleteRows="False"
                                  EnableRowVirtualization="True" EnableColumnVirtualization="True">
                            <DataGrid.Columns>
                                <DataGridCheckBoxColumn Header="" Binding="{Binding IsSelected, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="Auto" />
                                <DataGridTextColumn Header="Name" Binding="{Binding DisplayName}" Width="*" IsReadOnly="True" />
                                <DataGridTextColumn Header="EditorID" Binding="{Binding EditorID}" Width="200" IsReadOnly="True" />
                                <DataGridTextColumn Header="FormKey" Binding="{Binding FormKeyString}" Width="150" IsReadOnly="True">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock"><Setter Property="FontFamily" Value="Consolas" /><Setter Property="FontSize" Value="10" /></Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                            </DataGrid.Columns>
                        </DataGrid>
                        <Button Grid.Row="2" Content="Add Selected Factions to Entry" Command="{Binding AddSelectedFactionsToEntryCommand}" Padding="8,2" Margin="0,6,0,0" />
                    </Grid>
                </TabItem>

                <!-- Keywords Tab -->
                <TabItem Header="Keywords">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>
                        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,6">
                            <TextBlock Text="Search:" VerticalAlignment="Center" Margin="0,0,6,0" />
                            <TextBox Text="{Binding KeywordSearchText, UpdateSourceTrigger=PropertyChanged}" MinWidth="200" />
                        </StackPanel>
                        <DataGrid Grid.Row="1" ItemsSource="{Binding FilteredKeywords}" AutoGenerateColumns="False" CanUserAddRows="False" CanUserDeleteRows="False"
                                  EnableRowVirtualization="True" EnableColumnVirtualization="True">
                            <DataGrid.Columns>
                                <DataGridCheckBoxColumn Header="" Binding="{Binding IsSelected, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="Auto" />
                                <DataGridTextColumn Header="EditorID" Binding="{Binding EditorID}" Width="*" IsReadOnly="True" />
                                <DataGridTextColumn Header="FormKey" Binding="{Binding FormKeyString}" Width="150" IsReadOnly="True">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock"><Setter Property="FontFamily" Value="Consolas" /><Setter Property="FontSize" Value="10" /></Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                            </DataGrid.Columns>
                        </DataGrid>
                        <Button Grid.Row="2" Content="Add Selected Keywords to Entry" Command="{Binding AddSelectedKeywordsToEntryCommand}" Padding="8,2" Margin="0,6,0,0" />
                    </Grid>
                </TabItem>

                <!-- Races Tab -->
                <TabItem Header="Races">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>
                        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,6">
                            <TextBlock Text="Search:" VerticalAlignment="Center" Margin="0,0,6,0" />
                            <TextBox Text="{Binding RaceSearchText, UpdateSourceTrigger=PropertyChanged}" MinWidth="200" />
                        </StackPanel>
                        <DataGrid Grid.Row="1" ItemsSource="{Binding FilteredRaces}" AutoGenerateColumns="False" CanUserAddRows="False" CanUserDeleteRows="False"
                                  EnableRowVirtualization="True" EnableColumnVirtualization="True">
                            <DataGrid.Columns>
                                <DataGridCheckBoxColumn Header="" Binding="{Binding IsSelected, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="Auto" />
                                <DataGridTextColumn Header="Name" Binding="{Binding DisplayName}" Width="*" IsReadOnly="True" />
                                <DataGridTextColumn Header="EditorID" Binding="{Binding EditorID}" Width="200" IsReadOnly="True" />
                                <DataGridTextColumn Header="FormKey" Binding="{Binding FormKeyString}" Width="150" IsReadOnly="True">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock"><Setter Property="FontFamily" Value="Consolas" /><Setter Property="FontSize" Value="10" /></Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                            </DataGrid.Columns>
                        </DataGrid>
                        <Button Grid.Row="2" Content="Add Selected Races to Entry" Command="{Binding AddSelectedRacesToEntryCommand}" Padding="8,2" Margin="0,6,0,0" />
                    </Grid>
                </TabItem>
            </TabControl>
        </GroupBox>
    </Grid>
</UserControl>
